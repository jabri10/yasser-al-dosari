import asyncio
import sqlite3
from random import randint

# ============================
# Database Setup (SQLite)
# ============================

# Create and initialize SQLite database for storing character data
def create_database():
    conn = sqlite3.connect('game_data.db')
    cursor = conn.cursor()
    cursor.execute('''CREATE TABLE IF NOT EXISTS characters (
                        id INTEGER PRIMARY KEY,
                        name TEXT NOT NULL,
                        health INTEGER,
                        abilities TEXT,
                        clothing TEXT)''')
    conn.commit()
    conn.close()

# Function to save character to database
def save_character_to_db(name, health, abilities, clothing):
    conn = sqlite3.connect('game_data.db')
    cursor = conn.cursor()
    cursor.execute('''INSERT INTO characters (name, health, abilities, clothing) 
                      VALUES (?, ?, ?, ?)''', (name, health, abilities, clothing))
    conn.commit()
    conn.close()

# ============================
# Character Class
# ============================

# Character class with basic attributes
class Character:
    def __init__(self, name, health, abilities, clothing):
        self.name = name
        self.health = health
        self.abilities = abilities
        self.clothing = clothing  # Modest clothing attribute (only for male characters)

    def take_damage(self, damage):
        self.health -= damage
        if self.health < 0:
            self.health = 0
        print(f"{self.name} took {damage} damage, remaining health: {self.health}.")

    def heal(self, heal_amount):
        self.health += heal_amount
        print(f"{self.name} healed for {heal_amount}, current health: {self.health}.")

    def attack(self, target):
        damage = randint(10, 20)  # Random attack damage
        print(f"{self.name} attacks {target.name}!")
        target.take_damage(damage)

    def is_alive(self):
        return self.health > 0

# ============================
# Modest Clothing for Male Characters
# ============================

# List of possible modest clothing choices for male characters
def assign_clothing():
    clothing_options = ["Long Robe", "Jubba", "Shalwar Kameez", "Thobe"]
    return clothing_options[randint(0, len(clothing_options)-1)]

# ============================
# Asynchronous Programming (Combat Simulation)
# ============================

# Async function to simulate combat between two characters
async def combat(character1, character2):
    print(f"Combat begins between {character1.name} and {character2.name}!")

    while character1.is_alive() and character2.is_alive():
        character1.attack(character2)
        await asyncio.sleep(1)  # Simulate delay between actions
        if character2.is_alive():
            character2.attack(character1)
        await asyncio.sleep(1)

    if character1.is_alive():
        print(f"{character1.name} wins the fight!")
    else:
        print(f"{character2.name} wins the fight!")

# ============================
# Main Game Loop
# ============================

async def main():
    create_database()

    # Create two characters (both male with modest clothing)
    character1_name = input("Enter the name for the first character: ")
    character1_clothing = assign_clothing()
    character1 = Character(character1_name, 100, ["Sword Slash", "Shield Block"], character1_clothing)
    save_character_to_db(character1_name, 100, str(character1.abilities), character1_clothing)

    character2_name = input("Enter the name for the second character: ")
    character2_clothing = assign_clothing()
    character2 = Character(character2_name, 100, ["Bow Shot", "Stealth"], character2_clothing)
    save_character_to_db(character2_name, 100, str(character2.abilities), character2_clothing)

    # Display character information
    print(f"{character1.name} is wearing {character1.clothing} and has abilities: {character1.abilities}")
    print(f"{character2.name} is wearing {character2.clothing} and has abilities: {character2.abilities}")

    # Start combat
    await combat(character1, character2)

# Run the game asynchronously
if __name__ == "__main__":
    asyncio.run(main())
